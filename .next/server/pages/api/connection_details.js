"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "pages/api/connection_details";
exports.ids = ["pages/api/connection_details"];
exports.modules = {

/***/ "livekit-server-sdk":
/*!*************************************!*\
  !*** external "livekit-server-sdk" ***!
  \*************************************/
/***/ ((module) => {

module.exports = require("livekit-server-sdk");

/***/ }),

/***/ "(api)/./src/pages/api/connection_details.ts":
/*!*********************************************!*\
  !*** ./src/pages/api/connection_details.ts ***!
  \*********************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (/* binding */ handler)\n/* harmony export */ });\n/* harmony import */ var livekit_server_sdk__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! livekit-server-sdk */ \"livekit-server-sdk\");\n/* harmony import */ var livekit_server_sdk__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(livekit_server_sdk__WEBPACK_IMPORTED_MODULE_0__);\n// Next.js API route support: https://nextjs.org/docs/api-routes/introduction\n\nasync function handler(req, res) {\n    if (req.method !== \"POST\") {\n        return res.status(400).json({\n            error: \"Invalid method\"\n        });\n    }\n    const { username , room_name: room , character  } = req.body;\n    const apiKey = process.env.LIVEKIT_API_KEY;\n    const apiSecret = process.env.LIVEKIT_API_SECRET;\n    const wsUrl = process.env.LIVEKIT_WS_URL;\n    if (!apiKey || !apiSecret || !wsUrl) {\n        return res.status(500).json({\n            error: \"Server misconfigured\"\n        });\n    }\n    if (!username) return res.status(400).json({\n        error: \"Missing username\"\n    });\n    if (!character) return res.status(400).json({\n        error: \"Missing character\"\n    });\n    if (!room) return res.status(400).json({\n        error: \"Missing room_name\"\n    });\n    const livekitHost = wsUrl?.replace(\"wss://\", \"https://\");\n    const at = new livekit_server_sdk__WEBPACK_IMPORTED_MODULE_0__.AccessToken(apiKey, apiSecret, {\n        identity: username\n    });\n    const roomService = new livekit_server_sdk__WEBPACK_IMPORTED_MODULE_0__.RoomServiceClient(livekitHost, apiKey, apiSecret);\n    try {\n        await roomService.getParticipant(room, username);\n        return res.status(401).json({\n            error: \"Username already exists in room\"\n        });\n    } catch  {\n    // If participant doesn't exist, we can continue\n    }\n    at.addGrant({\n        room,\n        roomJoin: true,\n        canPublish: true,\n        canSubscribe: true\n    });\n    at.metadata = JSON.stringify({\n        character\n    });\n    res.status(200).json({\n        token: at.toJwt(),\n        ws_url: wsUrl\n    });\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9zcmMvcGFnZXMvYXBpL2Nvbm5lY3Rpb25fZGV0YWlscy50cy5qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7QUFBQSw2RUFBNkU7QUFLakQ7QUFrQmIsZUFBZUUsUUFDNUJDLEdBQW1CLEVBQ25CQyxHQUF1RCxFQUN2RDtJQUNBLElBQUlELElBQUlFLE1BQU0sS0FBSyxRQUFRO1FBQ3pCLE9BQU9ELElBQUlFLE1BQU0sQ0FBQyxLQUFLQyxJQUFJLENBQUM7WUFBRUMsT0FBTztRQUFpQjtJQUN4RCxDQUFDO0lBRUQsTUFBTSxFQUNKQyxTQUFRLEVBQ1JDLFdBQVdDLEtBQUksRUFDZkMsVUFBUyxFQUNWLEdBQUdULElBQUlVLElBQUk7SUFDWixNQUFNQyxTQUFTQyxRQUFRQyxHQUFHLENBQUNDLGVBQWU7SUFDMUMsTUFBTUMsWUFBWUgsUUFBUUMsR0FBRyxDQUFDRyxrQkFBa0I7SUFDaEQsTUFBTUMsUUFBUUwsUUFBUUMsR0FBRyxDQUFDSyxjQUFjO0lBRXhDLElBQUksQ0FBQ1AsVUFBVSxDQUFDSSxhQUFhLENBQUNFLE9BQU87UUFDbkMsT0FBT2hCLElBQUlFLE1BQU0sQ0FBQyxLQUFLQyxJQUFJLENBQUM7WUFBRUMsT0FBTztRQUF1QjtJQUM5RCxDQUFDO0lBRUQsSUFBSSxDQUFDQyxVQUFVLE9BQU9MLElBQUlFLE1BQU0sQ0FBQyxLQUFLQyxJQUFJLENBQUM7UUFBRUMsT0FBTztJQUFtQjtJQUN2RSxJQUFJLENBQUNJLFdBQVcsT0FBT1IsSUFBSUUsTUFBTSxDQUFDLEtBQUtDLElBQUksQ0FBQztRQUFFQyxPQUFPO0lBQW9CO0lBQ3pFLElBQUksQ0FBQ0csTUFBTSxPQUFPUCxJQUFJRSxNQUFNLENBQUMsS0FBS0MsSUFBSSxDQUFDO1FBQUVDLE9BQU87SUFBb0I7SUFFcEUsTUFBTWMsY0FBY0YsT0FBT0csUUFBUSxVQUFVO0lBRTdDLE1BQU1DLEtBQUssSUFBSXhCLDJEQUFXQSxDQUFDYyxRQUFRSSxXQUFXO1FBQUVPLFVBQVVoQjtJQUFTO0lBQ25FLE1BQU1pQixjQUFjLElBQUl6QixpRUFBaUJBLENBQUNxQixhQUFhUixRQUFRSTtJQUUvRCxJQUFJO1FBQ0YsTUFBTVEsWUFBWUMsY0FBYyxDQUFDaEIsTUFBTUY7UUFDdkMsT0FBT0wsSUFBSUUsTUFBTSxDQUFDLEtBQUtDLElBQUksQ0FBQztZQUFFQyxPQUFPO1FBQWtDO0lBQ3pFLEVBQUUsT0FBTTtJQUNOLGdEQUFnRDtJQUNsRDtJQUVBZ0IsR0FBR0ksUUFBUSxDQUFDO1FBQUVqQjtRQUFNa0IsVUFBVSxJQUFJO1FBQUVDLFlBQVksSUFBSTtRQUFFQyxjQUFjLElBQUk7SUFBQztJQUN6RVAsR0FBR1EsUUFBUSxHQUFHQyxLQUFLQyxTQUFTLENBQUM7UUFBRXRCO0lBQVU7SUFDekNSLElBQUlFLE1BQU0sQ0FBQyxLQUFLQyxJQUFJLENBQUM7UUFBRTRCLE9BQU9YLEdBQUdZLEtBQUs7UUFBSUMsUUFBUWpCO0lBQU07QUFDMUQsQ0FBQyIsInNvdXJjZXMiOlsid2VicGFjazovL3NwYXRpYWwtYXVkaW8vLi9zcmMvcGFnZXMvYXBpL2Nvbm5lY3Rpb25fZGV0YWlscy50cz80YThkIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIE5leHQuanMgQVBJIHJvdXRlIHN1cHBvcnQ6IGh0dHBzOi8vbmV4dGpzLm9yZy9kb2NzL2FwaS1yb3V0ZXMvaW50cm9kdWN0aW9uXHJcbmltcG9ydCB0eXBlIHsgTmV4dEFwaVJlcXVlc3QsIE5leHRBcGlSZXNwb25zZSB9IGZyb20gXCJuZXh0XCI7XHJcbmltcG9ydCBsaXZla2l0U2VydmVyLCB7XHJcbiAgQWNjZXNzVG9rZW4sXHJcbiAgUm9vbVNlcnZpY2VDbGllbnQsXHJcbn0gZnJvbSBcImxpdmVraXQtc2VydmVyLXNka1wiO1xyXG5pbXBvcnQgeyBDaGFyYWN0ZXJOYW1lIH0gZnJvbSBcIkAvY29tcG9uZW50cy9DaGFyYWN0ZXJTZWxlY3RvclwiO1xyXG5cclxuZXhwb3J0IHR5cGUgQ29ubmVjdGlvbkRldGFpbHNCb2R5ID0ge1xyXG4gIHJvb21fbmFtZTogc3RyaW5nO1xyXG4gIHVzZXJuYW1lOiBzdHJpbmc7XHJcbiAgY2hhcmFjdGVyOiBDaGFyYWN0ZXJOYW1lO1xyXG59O1xyXG5cclxuZXhwb3J0IHR5cGUgQ29ubmVjdGlvbkRldGFpbHMgPSB7XHJcbiAgdG9rZW46IHN0cmluZztcclxuICB3c191cmw6IHN0cmluZztcclxufTtcclxuXHJcbnR5cGUgRXJyb3JSZXNwb25zZSA9IHtcclxuICBlcnJvcjogc3RyaW5nO1xyXG59O1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgYXN5bmMgZnVuY3Rpb24gaGFuZGxlcihcclxuICByZXE6IE5leHRBcGlSZXF1ZXN0LFxyXG4gIHJlczogTmV4dEFwaVJlc3BvbnNlPENvbm5lY3Rpb25EZXRhaWxzIHwgRXJyb3JSZXNwb25zZT5cclxuKSB7XHJcbiAgaWYgKHJlcS5tZXRob2QgIT09IFwiUE9TVFwiKSB7XHJcbiAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oeyBlcnJvcjogXCJJbnZhbGlkIG1ldGhvZFwiIH0pO1xyXG4gIH1cclxuXHJcbiAgY29uc3Qge1xyXG4gICAgdXNlcm5hbWUsXHJcbiAgICByb29tX25hbWU6IHJvb20sXHJcbiAgICBjaGFyYWN0ZXIsXHJcbiAgfSA9IHJlcS5ib2R5IGFzIENvbm5lY3Rpb25EZXRhaWxzQm9keTtcclxuICBjb25zdCBhcGlLZXkgPSBwcm9jZXNzLmVudi5MSVZFS0lUX0FQSV9LRVk7XHJcbiAgY29uc3QgYXBpU2VjcmV0ID0gcHJvY2Vzcy5lbnYuTElWRUtJVF9BUElfU0VDUkVUO1xyXG4gIGNvbnN0IHdzVXJsID0gcHJvY2Vzcy5lbnYuTElWRUtJVF9XU19VUkw7XHJcblxyXG4gIGlmICghYXBpS2V5IHx8ICFhcGlTZWNyZXQgfHwgIXdzVXJsKSB7XHJcbiAgICByZXR1cm4gcmVzLnN0YXR1cyg1MDApLmpzb24oeyBlcnJvcjogXCJTZXJ2ZXIgbWlzY29uZmlndXJlZFwiIH0pO1xyXG4gIH1cclxuXHJcbiAgaWYgKCF1c2VybmFtZSkgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHsgZXJyb3I6IFwiTWlzc2luZyB1c2VybmFtZVwiIH0pO1xyXG4gIGlmICghY2hhcmFjdGVyKSByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oeyBlcnJvcjogXCJNaXNzaW5nIGNoYXJhY3RlclwiIH0pO1xyXG4gIGlmICghcm9vbSkgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHsgZXJyb3I6IFwiTWlzc2luZyByb29tX25hbWVcIiB9KTtcclxuXHJcbiAgY29uc3QgbGl2ZWtpdEhvc3QgPSB3c1VybD8ucmVwbGFjZShcIndzczovL1wiLCBcImh0dHBzOi8vXCIpO1xyXG5cclxuICBjb25zdCBhdCA9IG5ldyBBY2Nlc3NUb2tlbihhcGlLZXksIGFwaVNlY3JldCwgeyBpZGVudGl0eTogdXNlcm5hbWUgfSk7XHJcbiAgY29uc3Qgcm9vbVNlcnZpY2UgPSBuZXcgUm9vbVNlcnZpY2VDbGllbnQobGl2ZWtpdEhvc3QsIGFwaUtleSwgYXBpU2VjcmV0KTtcclxuXHJcbiAgdHJ5IHtcclxuICAgIGF3YWl0IHJvb21TZXJ2aWNlLmdldFBhcnRpY2lwYW50KHJvb20sIHVzZXJuYW1lKTtcclxuICAgIHJldHVybiByZXMuc3RhdHVzKDQwMSkuanNvbih7IGVycm9yOiBcIlVzZXJuYW1lIGFscmVhZHkgZXhpc3RzIGluIHJvb21cIiB9KTtcclxuICB9IGNhdGNoIHtcclxuICAgIC8vIElmIHBhcnRpY2lwYW50IGRvZXNuJ3QgZXhpc3QsIHdlIGNhbiBjb250aW51ZVxyXG4gIH1cclxuXHJcbiAgYXQuYWRkR3JhbnQoeyByb29tLCByb29tSm9pbjogdHJ1ZSwgY2FuUHVibGlzaDogdHJ1ZSwgY2FuU3Vic2NyaWJlOiB0cnVlIH0pO1xyXG4gIGF0Lm1ldGFkYXRhID0gSlNPTi5zdHJpbmdpZnkoeyBjaGFyYWN0ZXIgfSk7XHJcbiAgcmVzLnN0YXR1cygyMDApLmpzb24oeyB0b2tlbjogYXQudG9Kd3QoKSwgd3NfdXJsOiB3c1VybCB9KTtcclxufVxyXG4iXSwibmFtZXMiOlsiQWNjZXNzVG9rZW4iLCJSb29tU2VydmljZUNsaWVudCIsImhhbmRsZXIiLCJyZXEiLCJyZXMiLCJtZXRob2QiLCJzdGF0dXMiLCJqc29uIiwiZXJyb3IiLCJ1c2VybmFtZSIsInJvb21fbmFtZSIsInJvb20iLCJjaGFyYWN0ZXIiLCJib2R5IiwiYXBpS2V5IiwicHJvY2VzcyIsImVudiIsIkxJVkVLSVRfQVBJX0tFWSIsImFwaVNlY3JldCIsIkxJVkVLSVRfQVBJX1NFQ1JFVCIsIndzVXJsIiwiTElWRUtJVF9XU19VUkwiLCJsaXZla2l0SG9zdCIsInJlcGxhY2UiLCJhdCIsImlkZW50aXR5Iiwicm9vbVNlcnZpY2UiLCJnZXRQYXJ0aWNpcGFudCIsImFkZEdyYW50Iiwicm9vbUpvaW4iLCJjYW5QdWJsaXNoIiwiY2FuU3Vic2NyaWJlIiwibWV0YWRhdGEiLCJKU09OIiwic3RyaW5naWZ5IiwidG9rZW4iLCJ0b0p3dCIsIndzX3VybCJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(api)/./src/pages/api/connection_details.ts\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../webpack-api-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = (__webpack_exec__("(api)/./src/pages/api/connection_details.ts"));
module.exports = __webpack_exports__;

})();